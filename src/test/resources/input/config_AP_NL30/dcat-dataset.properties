################################################################################
# DCAT Dataset Mapping (DCAT-AP-NL 3.0 compliant)
# Adds landingPage/page, language, conformsTo; types theme, accessRights,
# applicableLegislation objects as required by NL SHACL.
################################################################################

### Subject IRI
subject.iri.json                         = $.datasetJson.persistentUrl

### Title
props.title_en.predicate                 = dct:title
props.title_en.as                        = literal
props.title_en.lang                      = en
props.title_en.json                      = $..metadataBlocks.citation.fields[?(@.typeName=='title')].value

### Description
props.description_en.predicate           = dct:description
props.description_en.as                  = literal
props.description_en.lang                = en
props.description_en.json                = $..metadataBlocks.citation.fields[?(@.typeName=='dsDescription')].value[*].dsDescriptionValue.value

### Identifier
props.identifier.predicate               = dct:identifier
props.identifier.as                      = literal
props.identifier.json                    = $.datasetJson.datasetVersion.datasetPersistentId

### Landing page & page (use persistent URL) ? must be foaf:Document
nodes.landing.kind                       = iri
nodes.landing.type                       = foaf:Document
nodes.landing.iri.json                   = $.datasetJson.persistentUrl
props.landing.predicate                  = dcat:landingPage
props.landing.as                         = node-ref
props.landing.node                       = landing
props.page.predicate                     = foaf:page
props.page.as                            = node-ref
props.page.node                          = landing

### Language (ENG)
nodes.lang.kind                          = iri
nodes.lang.type                          = dct:LinguisticSystem
nodes.lang.iri.const                     = http://publications.europa.eu/resource/authority/language/ENG
props.language.predicate                 = dct:language
props.language.as                        = node-ref
props.language.node                      = lang

### ConformsTo (minimal Standard)
nodes.std.kind                           = bnode
nodes.std.type                           = dct:Standard
nodes.std.props.title.predicate          = dct:title
nodes.std.props.title.as                 = literal
nodes.std.props.title.lang               = en
nodes.std.props.title.const              = DCAT-AP-NL 3.0 data publication profile
props.conformsTo.predicate               = dct:conformsTo
props.conformsTo.as                      = node-ref
props.conformsTo.node                    = std

### Access Rights (typed)
nodes.ar.kind                            = iri
nodes.ar.type                            = dct:RightsStatement
nodes.ar.iri.json                        = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNaccessRights')].value
nodes.ar.map.public                      = http://publications.europa.eu/resource/authority/access-right/PUBLIC
nodes.ar.map.restricted                  = http://publications.europa.eu/resource/authority/access-right/RESTRICTED
nodes.ar.map.non-public                  = http://publications.europa.eu/resource/authority/access-right/NON_PUBLIC
props.accessRights.predicate             = dct:accessRights
props.accessRights.as                    = node-ref
props.accessRights.node                  = ar

### Theme (typed)
nodes.theme.kind                         = iri
nodes.theme.type                         = skos:Concept
nodes.theme.multi                        = true
nodes.theme.iri.json                     = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNtheme')].value[*]
nodes.theme.map.ener                     = http://publications.europa.eu/resource/authority/data-theme/ENER
nodes.theme.map.tech                     = http://publications.europa.eu/resource/authority/data-theme/TECH
nodes.theme.map.envi                     = http://publications.europa.eu/resource/authority/data-theme/ENVI
# Provide labels locally so SHACL doesn't need remote fetch
nodes.theme.props.prefLabel.predicate    = skos:prefLabel
nodes.theme.props.prefLabel.as           = literal
nodes.theme.props.prefLabel.lang         = en
nodes.theme.props.prefLabel.json         = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNtheme')].value[*]
nodes.theme.props.prefLabel.map.ener     = Energy
nodes.theme.props.prefLabel.map.tech     = Technology
nodes.theme.props.prefLabel.map.envi     = Environment
props.theme.predicate                    = dcat:theme
props.theme.as                           = node-ref
props.theme.node                         = theme

### Keywords
props.keyword_en.predicate               = dcat:keyword
props.keyword_en.as                      = literal
props.keyword_en.lang                    = en
props.keyword_en.multi                   = true
props.keyword_en.json                    = $..metadataBlocks.citation.fields[?(@.typeName=='keyword')].value[*].keywordValue.value

### Publisher (FOAF Agent)
nodes.publisher.kind                     = iri
nodes.publisher.type                     = foaf:Agent
nodes.publisher.iri.const                = https://ror.org/01bnjb948
nodes.publisher.props.name_nl.predicate  = foaf:name
nodes.publisher.props.name_nl.as         = literal
nodes.publisher.props.name_nl.lang       = nl
nodes.publisher.props.name_nl.const      = Nederlandse Organisatie voor Toegepast Natuurwetenschappelijk Onderzoek (nl), TNO
nodes.publisher.props.name_en.predicate  = foaf:name
nodes.publisher.props.name_en.as         = literal
nodes.publisher.props.name_en.lang       = en
nodes.publisher.props.name_en.const      = Netherlands Organisation for Applied Scientific Research
props.publisher.predicate                = dct:publisher
props.publisher.as                       = node-ref
props.publisher.node                     = publisher

### Contact Point (vCard)
nodes.contact.kind                       = bnode
nodes.contact.type                       = vcard:Kind
nodes.contact.props.email.predicate      = vcard:hasEmail
nodes.contact.props.email.as             = iri
nodes.contact.props.email.const          = mailto:support@geologischedienst.nl
nodes.contact.props.url.predicate        = vcard:hasURL
nodes.contact.props.url.as               = iri
nodes.contact.props.url.const            = https://www.geologischedienst.nl/contact/
nodes.contact.props.fn_nl.predicate      = vcard:fn
nodes.contact.props.fn_nl.as             = literal
nodes.contact.props.fn_nl.lang           = nl
nodes.contact.props.fn_nl.const          = Geologische Dienst Nederland
nodes.contact.props.fn_en.predicate      = vcard:fn
nodes.contact.props.fn_en.as             = literal
nodes.contact.props.fn_en.lang           = en
nodes.contact.props.fn_en.const          = Geological Survey of the Netherlands
props.contactPoint.predicate             = dcat:contactPoint
props.contactPoint.as                    = node-ref
props.contactPoint.node                  = contact

### Creators (Authors ? FOAF Agent; prefer IRI when present)
nodes.creator.kind                       = iri
nodes.creator.type                       = foaf:Agent
nodes.creator.multi                      = true
nodes.creator.iri.json                   = $..metadataBlocks.citation.fields[?(@.typeName=='author')].value[?(@.authorName.value && @.authorIdentifier.value && @.authorIdentifier.value!='')].authorIdentifier.value
nodes.creator.props.name.predicate       = foaf:name
nodes.creator.props.name.as              = literal
nodes.creator.props.name.lang            = en
nodes.creator.props.name.json            = $..authorName.value
nodes.creator.props.classOrg.predicate   = rdf:type
nodes.creator.props.classOrg.as          = iri
nodes.creator.props.classOrg.const       = http://xmlns.com/foaf/0.1/Organization
nodes.creator.props.aff.predicate        = vcard:organization-name
nodes.creator.props.aff.as               = literal
nodes.creator.props.aff.lang             = en
nodes.creator.props.aff.json             = $..authorAffiliation.value
props.creator.predicate                  = dct:creator
props.creator.as                         = node-ref
props.creator.node                       = creator

### Applicable Legislation (typed)
nodes.legi.kind                          = iri
nodes.legi.type                          = eli:LegalResource
nodes.legi.iri.json                      = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNhvdCompliant')].value.GDNhvdApplicableLegislation.value
nodes.legi.map.eu_2023_138               = http://data.europa.eu/eli/reg_impl/2023/138/oj
props.appLeg.predicate                   = dcatap:applicableLegislation
props.appLeg.as                          = node-ref
props.appLeg.node                        = legi


################################################################################
# Static HVD concept nodes with labels
################################################################################

# GEOSPATIAL
nodes.hvd_geospatial.kind                = iri
nodes.hvd_geospatial.type                = skos:Concept
nodes.hvd_geospatial.iri.const           = http://publications.europa.eu/resource/dataset/high-value-dataset-category/GEOSPATIAL
nodes.hvd_geospatial.props.lbl.predicate = skos:prefLabel
nodes.hvd_geospatial.props.lbl.as        = literal
nodes.hvd_geospatial.props.lbl.lang      = en
nodes.hvd_geospatial.props.lbl.const     = Geospatial

# EARTH OBSERVATION & ENVIRONMENT
nodes.hvd_env.kind                       = iri
nodes.hvd_env.type                       = skos:Concept
nodes.hvd_env.iri.const                  = http://publications.europa.eu/resource/dataset/high-value-dataset-category/EARTH_OBSERVATION_AND_ENVIRONMENT
nodes.hvd_env.props.lbl.predicate        = skos:prefLabel
nodes.hvd_env.props.lbl.as               = literal
nodes.hvd_env.props.lbl.lang             = en
nodes.hvd_env.props.lbl.const            = Earth observation and environment

# METEOROLOGICAL
nodes.hvd_met.kind                       = iri
nodes.hvd_met.type                       = skos:Concept
nodes.hvd_met.iri.const                  = http://publications.europa.eu/resource/dataset/high-value-dataset-category/METEOROLOGICAL
nodes.hvd_met.props.lbl.predicate        = skos:prefLabel
nodes.hvd_met.props.lbl.as               = literal
nodes.hvd_met.props.lbl.lang             = en
nodes.hvd_met.props.lbl.const            = Meteorological

# STATISTICS
nodes.hvd_stat.kind                      = iri
nodes.hvd_stat.type                      = skos:Concept
nodes.hvd_stat.iri.const                 = http://publications.europa.eu/resource/dataset/high-value-dataset-category/STATISTICS
nodes.hvd_stat.props.lbl.predicate       = skos:prefLabel
nodes.hvd_stat.props.lbl.as              = literal
nodes.hvd_stat.props.lbl.lang            = en
nodes.hvd_stat.props.lbl.const           = Statistics

# COMPANIES & COMPANY OWNERSHIP
nodes.hvd_comp.kind                      = iri
nodes.hvd_comp.type                      = skos:Concept
nodes.hvd_comp.iri.const                 = http://publications.europa.eu/resource/dataset/high-value-dataset-category/COMPANIES_AND_COMPANY_OWNERSHIP
nodes.hvd_comp.props.lbl.predicate       = skos:prefLabel
nodes.hvd_comp.props.lbl.as              = literal
nodes.hvd_comp.props.lbl.lang            = en
nodes.hvd_comp.props.lbl.const           = Companies and company ownership

# MOBILITY
nodes.hvd_mob.kind                       = iri
nodes.hvd_mob.type                       = skos:Concept
nodes.hvd_mob.iri.const                  = http://publications.europa.eu/resource/dataset/high-value-dataset-category/MOBILITY
nodes.hvd_mob.props.lbl.predicate        = skos:prefLabel
nodes.hvd_mob.props.lbl.as               = literal
nodes.hvd_mob.props.lbl.lang             = en
nodes.hvd_mob.props.lbl.const            = Mobility


##############################################
# High-Value Dataset category (typed SKOS Concept)
##############################################

# Define dynamic HVD nodes typed as skos:Concept; map local values to EU vocab IRIs
nodes.hvd.kind                              = iri
nodes.hvd.type                              = skos:Concept
nodes.hvd.multi                             = true
nodes.hvd.iri.json                          = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNhvdCompliant')].value.GDNhvdCategory.value[*]
# Map Dataverse values to official EU HVD category IRIs
nodes.hvd.map.energy_resources              = http://publications.europa.eu/resource/dataset/high-value-dataset-category/EARTH_OBSERVATION_AND_ENVIRONMENT
nodes.hvd.map.env_monitoring                = http://publications.europa.eu/resource/dataset/high-value-dataset-category/EARTH_OBSERVATION_AND_ENVIRONMENT
nodes.hvd.map.area_management               = http://publications.europa.eu/resource/dataset/high-value-dataset-category/GEOSPATIAL
# Optional: attach local labels to avoid remote fetch in SHACL
nodes.hvd.props.prefLabel.predicate         = skos:prefLabel
nodes.hvd.props.prefLabel.as                = literal
nodes.hvd.props.prefLabel.lang              = en
nodes.hvd.props.prefLabel.json              = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNhvdCompliant')].value.GDNhvdCategory.value[*]
nodes.hvd.props.prefLabel.map.energy_resources = Earth observation and environment
nodes.hvd.props.prefLabel.map.env_monitoring   = Earth observation and environment
nodes.hvd.props.prefLabel.map.area_management  = Geospatial
# Emit as node references
props.hvdCategory.predicate                 = dcatap:hvdCategory
props.hvdCategory.as                        = node-ref
props.hvdCategory.node                      = hvd
##############################################
# Spatial coverage (address of the Geological Survey of the Netherlands)
# DCAT ? dct:spatial (Location) with LOCN address, derived from Dataverse geospatial fields.
################################################################################

# ---- Spatial node (Location)
props.spatial.predicate                  = dct:spatial
props.spatial.as                         = node-ref
props.spatial.node                       = gdn_loc

nodes.gdn_loc.kind                       = bnode
nodes.gdn_loc.type                       = dct:Location

# ---- Address node (LOCN Address)
nodes.gdn_addr.kind                      = bnode
nodes.gdn_addr.type                      = locn:Address

# Link Location ? Address
nodes.gdn_loc.props.address.predicate    = locn:address
nodes.gdn_loc.props.address.as           = node-ref
nodes.gdn_loc.props.address.node         = gdn_addr

# ---- Address parts from Dataverse JSON (geospatial.geographicCoverage[0].*)
# Thoroughfare: street + house number
nodes.gdn_addr.props.thoroughfare.predicate = locn:thoroughfare
nodes.gdn_addr.props.thoroughfare.as     = literal
nodes.gdn_addr.props.thoroughfare.json   = $..geospatial.fields[?(@.typeName=='geographicCoverage')].value[0].otherGeographicCoverage.value

# Post code
nodes.gdn_addr.props.postCode.predicate  = locn:postCode
nodes.gdn_addr.props.postCode.as         = literal
nodes.gdn_addr.props.postCode.const      = 3584 CB   # Or parse from your "otherGeographicCoverage" if you store it there

# City
nodes.gdn_addr.props.postName.predicate  = locn:postName
nodes.gdn_addr.props.postName.as         = literal
nodes.gdn_addr.props.postName.json       = $..geospatial.fields[?(@.typeName=='geographicCoverage')].value[0].city.value

# Administrative unit level 2 (province)
nodes.gdn_addr.props.adminUnitL2.predicate = locn:adminUnitL2
nodes.gdn_addr.props.adminUnitL2.as      = literal
nodes.gdn_addr.props.adminUnitL2.json    = $..geospatial.fields[?(@.typeName=='geographicCoverage')].value[0].state.value

# Administrative unit level 1 (country)
nodes.gdn_addr.props.adminUnitL1.predicate = locn:adminUnitL1
nodes.gdn_addr.props.adminUnitL1.as      = literal
nodes.gdn_addr.props.adminUnitL1.json    = $..geospatial.fields[?(@.typeName=='geographicCoverage')].value[0].country.value

# ---- Optional: country code (ISO 3166), if your SHACL profile requires it
nodes.gdn_addr.props.countryCode.predicate = locn:adminUnitL1
nodes.gdn_addr.props.countryCode.as      = literal
nodes.gdn_addr.props.countryCode.const   = NL

# ---- Optional: geometry (WKT) to satisfy Location shapes that ask for geometry
nodes.gdn_loc.props.geometry.predicate   = locn:geometry
nodes.gdn_loc.props.geometry.as          = node-ref
nodes.gdn_loc.props.geometry.node        = gdn_geom

nodes.gdn_geom.kind                      = bnode
nodes.gdn_geom.type                      = locn:Geometry

nodes.gdn_geom.props.asWKT.predicate     = geo:asWKT
nodes.gdn_geom.props.asWKT.as            = literal
nodes.gdn_geom.props.asWKT.datatype      = geo:wktLiteral
nodes.gdn_geom.props.asWKT.const         = POINT(5.1679 52.0883)

# ---- Optional: version
props.version.predicate = dct:version
props.version.as        = literal
props.version.json.1    = $.datasetJson.datasetVersion.versionNumber
props.version.json.2    = $.datasetJson.datasetVersion.versionMinorNumber
props.version.format    = V${1}.${2}

# Issued typed as xsd:date (YYYY-MM-DD)
props.issued.predicate  = dct:issued
props.issued.as         = literal
props.issued.datatype   = xsd:date
props.issued.json       = $.datasetJson.datasetVersion.publicationDate

# Modified: keep full ISO instant and type as xsd:dateTime (matches lexical '2024-03-20T14:02:13Z')
props.modified.predicate = dct:modified
props.modified.as        = literal
props.modified.datatype  = xsd:dateTime
props.modified.json      = $.datasetJson.datasetVersion.lastUpdateTime
# props.modified.transform = iso-date-only   # REMOVED to keep time component