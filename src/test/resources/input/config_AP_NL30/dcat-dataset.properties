################################################################################
# DCAT Dataset Mapping (DCAT-AP-NL 3.0 compliant)
# Adds landingPage/page, language, conformsTo; types theme, accessRights,
# applicableLegislation objects as required by NL SHACL.
################################################################################

### Subject IRI
subject.iri.json = $.datasetJson.persistentUrl

### Title
props.title_en.predicate = dct:title
props.title_en.as        = literal
props.title_en.lang      = en
props.title_en.json      = $..metadataBlocks.citation.fields[?(@.typeName=='title')].value

### Description
props.description_en.predicate = dct:description
props.description_en.as        = literal
props.description_en.lang      = en
props.description_en.json      = $..metadataBlocks.citation.fields[?(@.typeName=='dsDescription')].value[*].dsDescriptionValue.value

### Identifier
props.identifier.predicate = dct:identifier
props.identifier.as        = literal
props.identifier.json      = $.datasetJson.datasetVersion.datasetPersistentId

### Landing page & page (use persistent URL) ? must be foaf:Document
nodes.landing.kind      = iri
nodes.landing.type      = foaf:Document
nodes.landing.iri.json  = $.datasetJson.persistentUrl
props.landing.predicate = dcat:landingPage
props.landing.as        = node-ref
props.landing.node      = landing
props.page.predicate    = foaf:page
props.page.as           = node-ref
props.page.node         = landing

### Language (ENG)
nodes.lang.kind      = iri
nodes.lang.type      = dct:LinguisticSystem
nodes.lang.iri.const = http://publications.europa.eu/resource/authority/language/ENG
props.language.predicate = dct:language
props.language.as        = node-ref
props.language.node      = lang

### ConformsTo (minimal Standard)
nodes.std.kind                     = bnode
nodes.std.type                     = dct:Standard
nodes.std.props.title.predicate    = dct:title
nodes.std.props.title.as           = literal
nodes.std.props.title.lang         = en
nodes.std.props.title.const        = DCAT-AP-NL 3.0 data publication profile
props.conformsTo.predicate         = dct:conformsTo
props.conformsTo.as                = node-ref
props.conformsTo.node              = std

### Access Rights (typed)
nodes.ar.kind      = iri
nodes.ar.type      = dct:RightsStatement
nodes.ar.iri.json  = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNaccessRights')].value
nodes.ar.map.public      = http://publications.europa.eu/resource/authority/access-right/PUBLIC
nodes.ar.map.restricted  = http://publications.europa.eu/resource/authority/access-right/RESTRICTED
nodes.ar.map.non-public  = http://publications.europa.eu/resource/authority/access-right/NON_PUBLIC
props.accessRights.predicate = dct:accessRights
props.accessRights.as        = node-ref
props.accessRights.node      = ar

### Theme (typed)
nodes.theme.kind   = iri
nodes.theme.type   = skos:Concept
nodes.theme.multi  = true
nodes.theme.iri.json        = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNtheme')].value[*]
nodes.theme.map.ener        = http://publications.europa.eu/resource/authority/data-theme/ENER
nodes.theme.map.tech        = http://publications.europa.eu/resource/authority/data-theme/TECH
nodes.theme.map.envi        = http://publications.europa.eu/resource/authority/data-theme/ENVI
# Provide labels locally so SHACL doesn't need remote fetch
nodes.theme.props.prefLabel.predicate = skos:prefLabel
nodes.theme.props.prefLabel.as        = literal
nodes.theme.props.prefLabel.lang      = en
nodes.theme.props.prefLabel.json      = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNtheme')].value[*]
nodes.theme.props.prefLabel.map.ener  = Energy
nodes.theme.props.prefLabel.map.tech  = Technology
nodes.theme.props.prefLabel.map.envi  = Environment
props.theme.predicate       = dcat:theme
props.theme.as              = node-ref
props.theme.node            = theme

### Keywords
props.keyword_en.predicate = dcat:keyword
props.keyword_en.as        = literal
props.keyword_en.lang      = en
props.keyword_en.multi     = true
props.keyword_en.json      = $..metadataBlocks.citation.fields[?(@.typeName=='keyword')].value[*].keywordValue.value

### Publisher (FOAF Agent)
nodes.publisher.kind      = iri
nodes.publisher.type      = foaf:Agent
nodes.publisher.iri.const = https://ror.org/01bnjb948
nodes.publisher.props.name_nl.predicate = foaf:name
nodes.publisher.props.name_nl.as        = literal
nodes.publisher.props.name_nl.lang      = nl
nodes.publisher.props.name_nl.const     = Nederlandse Organisatie voor Toegepast Natuurwetenschappelijk Onderzoek (nl), TNO
nodes.publisher.props.name_en.predicate = foaf:name
nodes.publisher.props.name_en.as        = literal
nodes.publisher.props.name_en.lang      = en
nodes.publisher.props.name_en.const     = Netherlands Organisation for Applied Scientific Research
props.publisher.predicate = dct:publisher
props.publisher.as        = node-ref
props.publisher.node      = publisher

### Contact Point (vCard)
nodes.contact.kind                 = bnode
nodes.contact.type                 = vcard:Kind
nodes.contact.props.email.predicate= vcard:hasEmail
nodes.contact.props.email.as       = iri
nodes.contact.props.email.const    = mailto:support@geologischedienst.nl
nodes.contact.props.url.predicate  = vcard:hasURL
nodes.contact.props.url.as         = iri
nodes.contact.props.url.const      = https://www.geologischedienst.nl/contact/
nodes.contact.props.fn_nl.predicate= vcard:fn
nodes.contact.props.fn_nl.as       = literal
nodes.contact.props.fn_nl.lang     = nl
nodes.contact.props.fn_nl.const    = Geologische Dienst Nederland
nodes.contact.props.fn_en.predicate= vcard:fn
nodes.contact.props.fn_en.as       = literal
nodes.contact.props.fn_en.lang     = en
nodes.contact.props.fn_en.const    = Geological Survey of the Netherlands
props.contactPoint.predicate = dcat:contactPoint
props.contactPoint.as        = node-ref
props.contactPoint.node      = contact

### Creators (Authors ? FOAF Agent; prefer IRI when present)
nodes.creator.kind       = iri
nodes.creator.type       = foaf:Agent
nodes.creator.multi      = true
nodes.creator.iri.json   = $..metadataBlocks.citation.fields[?(@.typeName=='author')].value[?(@.authorName.value && @.authorIdentifier.value && @.authorIdentifier.value!='')].authorIdentifier.value
nodes.creator.props.name.predicate = foaf:name
nodes.creator.props.name.as        = literal
nodes.creator.props.name.lang      = en
nodes.creator.props.name.json      = $..authorName.value
nodes.creator.props.classOrg.predicate = rdf:type
nodes.creator.props.classOrg.as        = iri
nodes.creator.props.classOrg.const     = http://xmlns.com/foaf/0.1/Organization
nodes.creator.props.aff.predicate = vcard:organization-name
nodes.creator.props.aff.as        = literal
nodes.creator.props.aff.lang      = en
nodes.creator.props.aff.json      = $..authorAffiliation.value
props.creator.predicate = dct:creator
props.creator.as        = node-ref
props.creator.node      = creator

### Applicable Legislation (typed)
nodes.legi.kind      = iri
nodes.legi.type      = eli:LegalResource
nodes.legi.iri.json  = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNhvdCompliant')].value.GDNhvdApplicableLegislation.value
nodes.legi.map.eu_2023_138 = http://data.europa.eu/eli/reg_impl/2023/138/oj
props.appLeg.predicate = dcatap:applicableLegislation
props.appLeg.as        = node-ref
props.appLeg.node      = legi

### HVD Category
props.hvdCategory.predicate = dcatap:hvdCategory
props.hvdCategory.as        = iri
props.hvdCategory.multi     = true
props.hvdCategory.json      = $..GDNDatasetMetadata.fields[?(@.typeName=='GDNhvdCompliant')].value.GDNhvdCategory.value
props.hvdCategory.map.geology = http://publications.europa.eu/resource/dataset/high-value-dataset-category/GEOLOGY
